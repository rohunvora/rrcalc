<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Debug EV Check</title>
  <style>
    body { font-family: system-ui; padding: 20px; background: #000; color: #fff; }
    input, button { padding: 10px; margin: 5px; font-size: 16px; }
    #debug { background: #333; padding: 20px; margin: 20px 0; }
    #results { background: #111; padding: 20px; margin: 20px 0; }
  </style>
</head>
<body>
  <h1>Debug EV Check</h1>
  
  <div>
    <label>Entry MC: <input type="text" id="entry" placeholder="2M" /></label><br>
    <label>Position: <input type="text" id="position" placeholder="2.5k" /></label><br>
    <label>Max Loss %: <input type="number" id="maxLoss" placeholder="25" /></label><br>
    <label>Target MC: <input type="text" id="target" placeholder="10M" /></label><br>
    <label>Confidence %: <input type="range" id="confidence" min="5" max="50" value="20" /></label>
    <span id="confidence-display">20%</span><br>
    <button onclick="testCalculate()">Calculate</button>
  </div>
  
  <div id="debug">
    <h3>Debug Info:</h3>
    <div id="debug-output">Ready to debug...</div>
  </div>
  
  <div id="results">
    <h3>Results:</h3>
    <div id="results-output">No results yet...</div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const entry = $('entry');
    const position = $('position');
    const maxLoss = $('maxLoss');
    const target = $('target');
    const confidence = $('confidence');
    const confidenceDisplay = $('confidence-display');
    const debugOutput = $('debug-output');
    const resultsOutput = $('results-output');

    // Parse shorthand function
    function parseShorthand(value) {
      if (!value) return 0;
      value = value.toString().replace(/,/g, '');
      const upperValue = value.toUpperCase();
      if (upperValue.endsWith('K')) {
        return parseFloat(value) * 1000;
      } else if (upperValue.endsWith('M')) {
        return parseFloat(value) * 1000000;
      } else if (upperValue.endsWith('B')) {
        return parseFloat(value) * 1000000000;
      }
      return parseFloat(value) || 0;
    }

    function testCalculate() {
      debugOutput.innerHTML = 'Starting calculation...<br>';
      
      try {
        const entryMC = parseShorthand(entry.value);
        const targetMC = parseShorthand(target.value);
        const posSize = parseShorthand(position.value);
        const maxLossPct = parseFloat(maxLoss.value) || 25;
        const conf = parseFloat(confidence.value) / 100;

        debugOutput.innerHTML += `Entry MC: ${entryMC}<br>`;
        debugOutput.innerHTML += `Target MC: ${targetMC}<br>`;
        debugOutput.innerHTML += `Position: ${posSize}<br>`;
        debugOutput.innerHTML += `Max Loss %: ${maxLossPct}<br>`;
        debugOutput.innerHTML += `Confidence: ${conf}<br><br>`;

        // Check minimum inputs
        const hasMinimumInputs = entryMC > 0 && targetMC > 0 && posSize > 0 && maxLossPct > 0;
        debugOutput.innerHTML += `Has minimum inputs: ${hasMinimumInputs}<br>`;

        if (!hasMinimumInputs) {
          debugOutput.innerHTML += 'STOPPING: Insufficient inputs<br>';
          return;
        }

        // Calculate
        const multiple = targetMC / entryMC;
        const upsideRaw = posSize * Math.max(0, multiple - 1);
        const upsideAmount = upsideRaw; // No slippage for debug
        const downsideAmount = posSize * Math.min(1, maxLossPct / 100);
        const R = downsideAmount > 0 ? (upsideAmount / downsideAmount) : 0;
        const ev = (conf * upsideAmount) - ((1 - conf) * downsideAmount);

        debugOutput.innerHTML += `Multiple: ${multiple.toFixed(2)}<br>`;
        debugOutput.innerHTML += `Upside: $${upsideAmount.toFixed(2)}<br>`;
        debugOutput.innerHTML += `Downside: $${downsideAmount.toFixed(2)}<br>`;
        debugOutput.innerHTML += `R: ${R.toFixed(2)}<br>`;
        debugOutput.innerHTML += `EV: $${ev.toFixed(2)}<br>`;

        // Verdict
        let verdict;
        if (ev > 0 && R >= 2) {
          verdict = 'ALLOWED';
        } else {
          verdict = 'FOLD';
        }

        resultsOutput.innerHTML = `
          <strong>VERDICT: ${verdict}</strong><br>
          EV: $${ev.toFixed(2)}<br>
          R Multiple: ${R.toFixed(1)}R<br>
          Upside: +$${upsideAmount.toFixed(2)}<br>
          Downside: -$${downsideAmount.toFixed(2)}
        `;

      } catch (error) {
        debugOutput.innerHTML += `ERROR: ${error.message}<br>`;
      }
    }

    // Update confidence display
    confidence.addEventListener('input', (e) => {
      confidenceDisplay.textContent = e.target.value + '%';
    });

    // Auto-calculate on input changes
    [entry, position, maxLoss, target, confidence].forEach(input => {
      input.addEventListener('input', testCalculate);
    });

    console.log('Debug script loaded successfully');
  </script>
</body>
</html>
